<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>



<!-- ****************** css ************************* -->
<style>

    html, body{
        box-sizing: border-box;
        margin: 0px;
        padding: 0px;
    }

    .areaCanvas{
        margin-top: 30px;
        margin-left: auto !important;
        margin-right: auto !important;
        /* width: calc((100vw - (100vw - 100%))*0.9); */
        height: 500px;
        width: 500px;
        background-color: lavender;
        border: 1px solid black;    
    }

</style>


<!-- ************************** js ****************************-->
<script>

    //**************************listener***********************************

    window.addEventListener('load', init, false);


    //********************declaracos e inicializacao***********************

    //legado canvas
    var canvas;
    var canvasContext;
    var canvasWidth;
    var canvasHeight;
    var defaultCanvasWidth = 500;
    var defaultCanvasHeight = 500;

    //feature imagem q ja foi iniciada a implementacao infelizmente na master
    
    idleState1 = {
        x: 50,
        y: 50,
        width: 5,
        height: 5,
        directions: {
            "none" : 1, 
            "up" : 0, 
            "down" : 0, 
            "left": 0,
            "right": 0
        } 
    }

    //Animation Logical Variables
    var idleImage;
    var idleImageWidth = 575;
    var idleImageHeight = 523;

    var logicalFramePosition = 0;

    //logical 2d model assign
    var dogModel2dStates = {
        "idle" : 0,
        "stun" : 4
    };

    //Animation 2d models
    var dogModel = {
        width: idleImageWidth,
        height: idleImageHeight,
        spriteModel2dState: dogModel2dStates, //esse sim é um dos poquissimos idles q faz sentido
        positionFrameActionState: 1,
        currentState: 0,
        currentAction: "idle"
    } 

    //parei aqui, negocio é o action e o state sao 
    models = [];
    models["dog"] = dogModel;

    //*************** Funcoes de proposito Geral *******************
    function initCss(){
        document.getElementById('canvas').style.width = defaultCanvasWidth;
        document.getElementById('canvas').style.height = defaultCanvasHeight;
        document.getElementById('areaCanvas').style.width = defaultCanvasWidth + "px";
        document.getElementById('areaCanvas').style.height = defaultCanvasHeight + "px";
    }//hello

    function init(){
        
        initCss();
        initCanvas();
        initImageResources();
        animate();
    }

    function initImageResources(){
        // idleImage = new Image();
        // idleImage.src = "assets/idleImage.png";
        idleImage = document.getElementById("dog");
    }

    function initCanvas(){
        canvas = document.getElementById('canvas');
        canvasContext = canvas.getContext('2d');
        canvasWidth = canvas.width = defaultCanvasWidth;
        canvasHeight = canvas.height = defaultCanvasHeight;
    }
    //********************* End Funcoes Geral **********************



    //********************* Trecho de Animacao *********************
    function drawSquare(obj){

        var x = obj.x;
        var y = obj.y;
        var width = obj.width;
        var height = obj.height;

        canvasContext.fillRect(x, y, width, height);
    }

    function drawImage(img){

        var obj = models[img.id];
        console.log(obj.spriteModel2dState[obj.currentState])
        canvasContext.drawImage(img, idleImageWidth * (obj.spriteModel2dState[obj.currentState]), idleImageHeight * (obj.spriteModel2dState[obj.currentAction]), 
                                idleImageWidth, idleImageHeight, 125 , 125, canvasWidth/2, canvasHeight/2);
    }


    //********************* End Animacao *********************



    //********************* Animacao Central *********************
    //loop animacao - um apenas starta com algumas medidas e alocacaoes e a outra funcao q eh o loop em si

    function animate(){
        
        canvasContext.clearRect(0, 0, canvasWidth, canvasHeight);
        
        drawSquare(idleState1);// O Idle em si

        drawImage(idleImage);//idleImage é o Elemento
        
        requestAnimationFrame(animate);
    }

</script>


<body>
    
    <img id="dog" src="assets/idleImage.png" style="display:none;" onload="initImageResources()">
    
    <div class="areaCanvas" id="areaCanvas">
        <canvas id="canvas">
        </canvas>
    </div>
    
</body>
</html>